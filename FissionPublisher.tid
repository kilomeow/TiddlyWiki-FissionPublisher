created: 20210302134745238
description: Publish static tiddlers to Fission
list: readme license history
modified: 20210308125420130
plugin-type: plugin
tags: 
title: $:/plugins/kilomeow/FissionPublisher
type: application/json

{"tiddlers":{"$:/plugins/kilomeow/FissionPublisher/Publish":{"title":"$:/plugins/kilomeow/FissionPublisher/Publish","created":"20210308161403675","modified":"20210310185332763","tags":"","type":"text/vnd.tiddlywiki","text":"<$publish>"},"$:/plugins/kilomeow/FissionPublisher/global.template":{"title":"$:/plugins/kilomeow/FissionPublisher/global.template","created":"20210309142604463","modified":"20210310185250582","tags":"","type":"text/vnd.tiddlywiki","text":"\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline html\n\n<html>\n  <head>\n    <title>\n      Fission powered blog\n    </title>\n  </head>\n<body>\n\n<style>\n  html {\n      font-family: Arial, sans-serif;\n      font-size: .938em;\n      line-height: 1.4;\n      background-color: #feffff;\n  }\n\n  body {\n      margin: 0 !important;\n      padding: 0 !important;\n  }\n\n  ::selection {\n      background: #009954;\n      color:  #feffff;\n  }\n\n  .top-panel {\n      margin-top: 0;\n      display: block;\n      width: 100%;\n      height: 6em;\n  }\n\n  .top-panel h1 {\n      margin: 0;\n  }\n\n  .top-panel .about {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      justify-content: center;\n  }\n\n  .top-panel .logo {\n      margin-left: 1em;\n      display: inline-block;\n      width: 10em;\n      height: 100%;\n      background: url(https://flagcattw.fission.app/tiddlywiki-character-transparent.png) top left;\n      background-size: contain;\n      background-repeat: no-repeat;\n      float: left;\n  }\n\n  .flow {\n      max-width: calc(max(120vh, 50em));\n      margin: 0 auto;\n  }\n\n  .tiddler {\n      background-color: #f4f5f8;\n      padding: 1em;\n      margin-top: 1em;\n  }\n\n  .tiddler-date .time-string {\n      color: #009954;\n  }\n</style>\n\n<div class=\"top-panel\">\n  <div class=\"logo\">\n  </div>\n  <div class=\"about\">\n  <span class=\"blog-title\">\n    <h1>Fission powered blog</h1>\n  </span>\n  </div>\n</div>\n\n<div class=\"flow\">\n<$transclude />\n</div>\n</body>\n</html>"},"$:/plugins/kilomeow/FissionPublisher/individual.template":{"title":"$:/plugins/kilomeow/FissionPublisher/individual.template","created":"20210308125957255","modified":"20210309144504513","tags":"","type":"text/vnd.tiddlywiki","text":"<div class=\"tiddler\">\n\n<div class=\"tiddler-title\">\n<h2><<currentTiddler>></h2>\n</div>\n\n<div class=\"tiddler-date\">\n<span class=\"time-string\">\n<$view tiddler=<<currentTiddler>> field=\"modified\" format=\"date\" template={{$:/language/Tiddler/DateFormat}}/>\n</span>\n</div>\n\n<div class=\"tiddler-content\">\n<$transclude tiddler=<<currentTiddler>> field=\"text\"/>\n</div>\n\n</div>"},"$:/plugins/kilomeow/FissionPublisher/widgets/publish.js":{"title":"$:/plugins/kilomeow/FissionPublisher/widgets/publish.js","text":"/*\\\ncreated: 20210309133226405\ntype: application/javascript\ntitle: $:/plugins/kilomeow/FissionPublisher/widgets/publish.js\ntags: \nmodified: 20210310182541681\nmodule-type: widget\n\\*/\n(function(){\n\n/*jslint node: true, browser: true */\n/*global $tw: false */\n\"use strict\";\n\nvar Widget = require(\"$:/core/modules/widgets/widget.js\").widget;\n\nvar PublishWidget = function(parseTreeNode, options) {\n  this.initialise(parseTreeNode, options);\n};\n  \nPublishWidget.prototype = new Widget();\n\n/* Renders this widget into the DOM. */\nPublishWidget.prototype.render = function(parent,nextSibling) {\n\tthis.parentDomNode = parent;\n\tthis.computeAttributes();\n\tvar html = this.compile(\"blog\", \"$:/plugins/kilomeow/FissionPublisher/individual.template\", \"$:/plugins/kilomeow/FissionPublisher/global.template\");\n\tvar html_blob = new Blob([html], {type: 'text/html'});\n\tvar html_url = URL.createObjectURL(html_blob);\n\tvar link = this.document.createElement(\"a\");\n\tlink.href = html_url;\n\tlink.download = \"publish.html\";\n\tlink.appendChild(this.document.createTextNode(\"Download\"));\n\tparent.insertBefore(link, nextSibling);\n\tthis.domNodes.push(link);\n};\n\nPublishWidget.prototype.compile = function(tag_name, tiddler_template, global_template) {\n  var tiddlers = $tw.wiki.getTiddlersWithTag(tag_name),\n        parser = $tw.wiki.parseTiddler(tiddler_template),\n        html = [];\n  \n    tiddlers.forEach((title) => {\n\t\t\tvar variables = {currentTiddler: title};\n\t\t\tvar widgetNode = $tw.wiki.makeWidget(parser,{variables: variables}),\n      \tcontainer = $tw.fakeDocument.createElement(\"div\");\n\t\t\twidgetNode.render(container,null);\n\t\t\thtml.push(container.innerHTML);\n  });\n\t\n\t$tw.wiki.addTiddler({\n            title: \"$:/state/publish\",\n            text: html.join(\"\\n\") \n\t});\n\t\n\tvar global_parser = $tw.wiki.parseTiddler(global_template, {parseAsInline: true});\n\t\n\tconsole.log(global_parser.tree);\n\t\n\tvar widgetNode = $tw.wiki.makeWidget(global_parser,\n\t\t{ variables: {currentTiddler: \"$:/state/publish\"},\n\t\t  parseAsInline: true }),\n      \tcontainer = $tw.fakeDocument.createElement(\"div\");\n\twidgetNode.render(container,null);\n\t\n\tconsole.log(\"res:\", container.innerHTML);\n\t\n\tlet root = container.childNodes[0];\n\t\n\treturn (root.tagName == \"html\") ? container.innerHTML : root.innerHTML;\n\t\n};\n\nexports.publish = PublishWidget;\n\n})();","created":"20210309133226405","type":"application/javascript","tags":"","modified":"20210310182541681","module-type":"widget"}}}